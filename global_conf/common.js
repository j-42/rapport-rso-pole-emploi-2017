"use strict";!function(e){function t(){var t=0,i=e.Main.xmlManager.get("statistics","servers").childNodes;for(t=0;t<i.length;t++)i[t].tagName&&a(i[t]);var l=e.Main.xmlManager.get("statistics","events");if(l)for(l=l.children,t=0;t<l.length;t++)g[l[t].getAttribute("name")]={category:l[t].getAttribute("category"),action:l[t].getAttribute("action"),label:l[t].getAttribute("title")};else c=!0;var r=e.Main.xmlManager.get("statistics","pages");if(r)for(r=r.children,t=0;t<r.length;t++)s[r[t].getAttribute("name")]={url:r[t].getAttribute("url"),title:r[t].getAttribute("title")};else o=!0;NIApi.register("stat.trackPage",function(e,t){return this.trackPage({name:e,variables:t}),Promise.resolve()}.bind(this)),NIApi.register("stat.trackEvent",function(e,t){return this.trackEvent({name:e,variables:t}),Promise.resolve()}.bind(this)),NIApi.register("stat.trackCustomPage",function(e,t,a){return this.trackCustomPage({url:e,title:t,variables:a}),Promise.resolve()}.bind(this)),NIApi.register("stat.trackCustomEvent",function(e,t,a,i){return this.trackCustomEvent({category:e,action:t,label:a,variables:i}),Promise.resolve()}.bind(this))}function a(t){var a=u[t.tagName],i="modules/"+a+"/js/index.js";"undefined"==typeof a&&(a=t.tagName,i="js/"+a+"Tracker",e.addCustomTemplate("js","js/"+a+"Tracker.js","${template}html/js/modules/"+a+"Tracker.js")),e.require([i]).then(function(){n.push(new(e.Class[e.Utils.capitalize(a+"Tracker")])(t))})}function i(){for(var e=Array.prototype.slice.call(arguments),t=0;t<e.length;t++)if("undefined"!=typeof e[t])return e[t]}function l(e,t){for(var a in t)e=e.replace("${"+a+"}",t[a]);return e}var r="",n=[],o=!1,s={},c=!1,g={},u={GoogleAnalytics:"analytics",Piwik:"piwik",WebTrends:"webtrends",Xiti:"xiti"},b={page:{page:{url:"page=${1}",title:"page ${1}"},"page-alt":{url:"page=${1}-${2}",title:"pages ${1} and ${2}"},thumbnails:{url:"thumbnails",title:"page list"},search:{url:"search",title:"search panel"},"search-alt":{url:"search=${1}",title:'search for "${1}"'},pdf:{url:"pdf",title:"pdf generation"},print:{url:"print",title:"print"},contents:{url:"contents",title:"contents"},welcomepage:{url:"welcomepage",title:"welcome page"},share:{url:"share",title:"sharing"},"share-email":{url:"share=email",title:"email sharing"},"wishlist-list":{url:"wishlist=list",title:"wishlist cart"},"wishlist-product":{url:"wishlist=add&wishlistid=${1}",title:"wishlist product #${1}"},"wishlist-checkout":{url:"wishlist=checkout",title:"wishlist checkout"},favorites:{url:"favorites",title:"favorites list"},sharedby:{url:"sharedby",title:"shared by someone list"}},event:{pdfDownload:{action:"pdfDownload-${1}",label:"pdf download",category:"download"},externalLink:{action:"externalLink",label:"external link to ${1}",category:"navigation"},videoPlay:{action:"videoPlay-${1}",label:"video play at ${1}",category:"enrichment"},videoPause:{action:"videoPause-${1}",label:"video pause at ${1}",category:"enrichment"},videoEnd:{action:"videoEnd",label:"video played",category:"enrichment"},shareMail:{action:"share-mail",label:"share by email",category:"share"},shareSocial:{action:"share-${1}",label:"share on ${1}",category:"share"},print:{action:"print-${1}",label:"print",category:"print"},bookmark:{action:"bookmark-${1}",label:"page ${1} bookmarked",category:"bookmark"},unbookmark:{action:"unbookmark-${1}",label:"page ${1} removed from bookmarks",category:"bookmark"},link:{action:"link-${1}-${2}",label:"enrichment click",category:"enrichment"},pageView:{action:"pageView-${1}",label:"page ${1} viewed",category:"navigation"},pageNext:{action:"pageNext-${1}",label:"next page of ${1}",category:"navigation"},pagePrev:{action:"pagePrev-${1}",label:"previous page of ${1}",category:"navigation"},"wishlist-submitted":{action:"wishlist-submitted",label:"Wishlist submitted",category:"wishlist"},lightboxOpen:{action:"lightboxOpen-${1}",label:"Opening lightbox ${1}",category:"lightbox"},lightboxClose:{action:"lightboxClose-${1}",label:"Closing lightbox ${1}",category:"lightbox"},zoomIn:{action:"zoomIn-${1}",label:"zoom in page ${1}",category:"navigation"},zoomOut:{action:"zoomOut-${1}",label:"zoom out page ${1}",category:"navigation"},fullScreenOn:{action:"fullScreenOn",label:"full screen activated",category:"navigation"},fullScreenOff:{action:"fullScreenOff",label:"full screen deactivated",category:"navigation"},menuOpen:{action:"menuOpen",label:"open the menu",category:"menu"},menuClose:{action:"menuClose",label:"close the menu",category:"menu"}}};t.prototype.trackPage=function(t){var a=s[t.name],c=b.page[t.name];if("undefined"!=typeof t.name&&(o!==!1||"undefined"!=typeof a)&&t.url!==r){"page"===t.name&&2===Object.keys(t.variables).length?c=b.page["page-alt"]:"zoom"===t.name&&2===Object.keys(t.variables).length&&(c=b.page["zoom-alt"]),a=a||{},t.variables=t.variables||{},t.url=i(a.url,t.url,c.url),t.url=location.pathname+location.search+"#"+t.url,t.title=i(a.title,t.title,c.title),t.url=l(t.url,t.variables),t.url=e.Utils.whitelistParameters(t.url),t.title=l(t.title,t.variables);for(var g=0;g<n.length;g++)n[g].trackPage(location.pathname,t.url,t.title);r=t.url}},t.prototype.trackEvent=function(e){var t=g[e.name],a=b.event[e.name];if("undefined"!=typeof e.name&&(c!==!1||"undefined"!=typeof t)){t=t||{},e.variables=e.variables||{},e.category=i(t.category,e.category,a.category),e.action=i(t.action,e.action,a.action),e.label=i(t.label,e.label,a.label),e.category=l(e.category,e.variables),e.action=l(e.action,e.variables),e.label=l(e.label,e.variables);for(var r=0;r<n.length;r++)n[r].trackEvent(e.category,e.action,e.label,e.value)}},t.prototype.trackCustomPage=function(t){if(t.url!==r){e.Utils._assertString(t.url,"The page URL should be a string"),e.Utils._assertString(t.title,"The page title should be a string"),r=t.url,t.variables=t.variables||{},t.url=location.pathname+location.search+"#"+t.url,t.url=l(t.url,t.variables),t.url=e.Utils.whitelistParameters(t.url),t.title=l(t.title,t.variables);for(var a=0;a<n.length;a++)n[a].trackPage(location.pathname,t.url,t.title)}},t.prototype.trackCustomEvent=function(t){e.Utils._assertString(t.category,"The page URL should be a string"),e.Utils._assertString(t.action,"The page title should be a string"),e.Utils._assertString(t.label,"The page title should be a string"),t.variables=t.variables||{},t.category=l(t.category,t.variables),t.action=l(t.action,t.variables),t.label=l(t.label,t.variables);for(var a=0;a<n.length;a++)n[a].trackEvent(t.category,t.action,t.label,t.value)},e.Class.TrackerManager=t}(webpublicationNamespace);