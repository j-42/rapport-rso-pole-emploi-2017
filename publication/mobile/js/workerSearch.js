"use strict";!function(e){function t(){this.pageLength=0,this.stringSize=50,this.stringPrefix="...",this.stringSuffix="...",this.xmlUrl="",this.currentSearch=""}var r={},a={};t.prototype.loadXml=function(e){if(!r[e]){r[e]=[];var t=this.xmlUrl.replace("%num%",e),a=new XMLHttpRequest;a.open("GET",t,!0),a.onreadystatechange=function(){4===a.readyState&&self.postMessage({method:"parse",data:a.responseText,page:e})},a.send()}},t.prototype.normalize=function(e){for(var t=["ßàáâãäåæçèéêëìíîïðñòóôõöøšùúûüýýþÿž","saaaaaaaceeeeiiiidnoooooosuuuuyybyz"],r={},a=0,n=t[0].length;a<n;a++)r[t[0][a]]=new RegExp(t[0][a],"g");return function(e){if("string"!=typeof e)return e;e=e.toLowerCase();for(var a=0,n=t[0].length;a<n;a++)e=e.replace(r[t[0][a]],t[1][a]);return e.replace(/[^\w\u4E00-\uFA29]/g,"-")}}(),t.prototype.parseJson=function(e,t){if(0===e)for(var n=t.texts.page,i=0;i<n.length;i++){a[n[i]["@num"]]=n[i]["@label"]||n[i]["@l"],r[n[i]["@num"]]=[];var s=n[i].block;if("undefined"!=typeof s)if(s instanceof Array)for(var o=0;o<s.length;o++)r[n[i]["@num"]].push(s[o].keyValue);else r[n[i]["@num"]].push(s.keyValue);else n[i].keyValue&&r[n[i]["@num"]].push(n[i].keyValue);r[n[i]["@num"]]=r[n[i]["@num"]].join(" — ").replace(/\s+—[\s—]+/gim," — ")}else{var h=t.page.block;r[e]=[];for(var f=0;f<h.length;f++)r[e].push(h[f].keyValue);r[e]=r[e].join(" — ").replace(/\s+—[\s—]+/," — ")}},t.prototype.prepareCache=function(){if(this.xmlUrl.indexOf("%num%")!==-1)for(var e=1;e<this.pageLength;e++)this.loadXml(e);else this.loadXml(0)},t.prototype.setPageLength=function(e){this.pageLength=e},t.prototype.setXmlUrl=function(e){this.xmlUrl=e},t.prototype.setPrefix=function(e){"undefined"!=typeof e&&(this.stringPrefix=e)},t.prototype.setWordSearch=function(e){"undefined"!=typeof e&&(this.wordSearch=e)},t.prototype.setSuffix=function(e){"undefined"!=typeof e&&(this.stringSuffix=e)},t.prototype.setStringSize=function(e){"undefined"!=typeof e&&(this.stringSize=e)},t.prototype.start=function(e){function t(e,t){return e.indexOf(t)>-1&&(n=e.indexOf(t),!0)}var n;this.currentSearch=e;var i=e;e=this.normalize(e);for(var s=Object.keys(r),o=0;o<s.length;o++){var h,f=this.normalize(r[s[o]]);if(this.wordSearch?h=e.split("-").every(t.bind(this,f)):(n=f.indexOf(e),h=n!==-1),h){var p=Math.min(r[s[o]].length+e.length,n+e.length+this.stringSize),l=Math.max(n-this.stringSize,0),u=r[s[o]].substring(l,p);if(l>0&&(u=this.stringPrefix+u),p<r[s[o]].length&&(u+=this.stringSuffix),u=this.wordSearch?u.replace(new RegExp("("+e.split("-").join("[^a-zA-Z0-9]")+"|"+e.replace(/-/gim,"|")+"|"+i.replace(/-/gim,"|")+")","igm"),"<b>$1</b>"):u.replace(new RegExp("("+e+"|"+i+")","igm"),"<b>$1</b>"),this.normalize(this.currentSearch)===e){var c={method:"result",page:s[o],string:u};a[s[o]]&&(c.label=a[s[o]]),self.postMessage(c)}}}self.postMessage({method:"end"})},e.Search=t}(self);var search=new Search;self.addEventListener("message",function(e){"config"===e.data.method?(search.setPageLength(e.data.pageLength),search.setXmlUrl(e.data.xmlUrl),search.setPrefix(e.data.prefix),search.setSuffix(e.data.suffix),search.setStringSize(e.data.stringSize),search.setWordSearch(e.data.wordSearch),search.prepareCache()):"search"===e.data.method?search.start(e.data.search):"parsedString"===e.data.method&&search.parseJson(e.data.page,e.data.data)},!1);